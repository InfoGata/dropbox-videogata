(()=>{const e="/plugins.json",t="/playlists.json";let a;const s=e=>{application.postUiMessage(e)},o=e=>{a=new Dropbox.DropboxAuth({clientId:e||"zuhlmfbhfnos8tu"})},c=(e,t)=>{a.setAccessToken(e),a.setRefreshToken(t)},l=async(e,t)=>{const s=new Dropbox.Dropbox({auth:a});await s.filesUpload({path:e,mute:!0,mode:{".tag":"overwrite"},contents:JSON.stringify(t)})},n=async e=>{const t=new Dropbox.Dropbox({auth:a}),s=(await t.filesDownload({path:e})).result.fileBlob,o=await s.text();return JSON.parse(o)};application.onUiMessage=async a=>{switch(a.type){case"login":let i=a.accessToken,r=a.refreshToken;localStorage.setItem("access_token",i),localStorage.setItem("refresh_token",r),c(i,r);break;case"check-login":const p=localStorage.getItem("access_token");p&&s({type:"login",accessToken:p}),await(async()=>{const e=document.location.host.split(".");e.shift();const t=e.join("."),a=`${document.location.protocol}//${t}`,o=await application.getPluginId(),c=localStorage.getItem("clientId")??"";s({type:"info",origin:a,pluginId:o,clientId:c})})();break;case"save-plugins":await(async()=>{const t=await application.getPlugins();await l(e,t),s({type:"message",message:"Successfully saved plugins."})})();break;case"load-plugins":await(async()=>{const t=await n(e);application.installPlugins(t)})();break;case"save-playlists":await(async()=>{const e=await application.getPlaylists();await l(t,e),s({type:"message",message:"Successfully saved playlists."})})();break;case"load-playlists":await(async()=>{const e=await n(t);await application.addPlaylists(e),s({type:"message",message:"Successfully added playlists."})})();break;case"set-keys":localStorage.setItem("clientId",a.clientId),o(a.clientId);break;case"logout":localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token")}};(async()=>{await new Promise(((e,t)=>{const a=document.createElement("script");a.src="https://unpkg.com/dropbox/dist/Dropbox-sdk.min.js",a.type="text/javascript",document.getElementsByTagName("head")[0].appendChild(a),a.onload=()=>{e()},a.onerror=()=>{t()}}));const e=localStorage.getItem("clientId");o(e);let t=localStorage.getItem("access_token"),a=localStorage.getItem("refresh_token");t&&a&&c(t,a)})()})();