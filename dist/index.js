const y="zuhlmfbhfnos8tu",i="/plugins.json",r="/playlists.json";let a;const n=e=>{application.postUiMessage(e)},p=e=>{a=new Dropbox.DropboxAuth({clientId:e||y})},g=(e,t)=>{a.setAccessToken(e),a.setRefreshToken(t)},d=async(e,t)=>{await new Dropbox.Dropbox({auth:a}).filesUpload({path:e,mute:!0,mode:{".tag":"overwrite"},contents:JSON.stringify(t)})},u=async e=>{const c=await(await new Dropbox.Dropbox({auth:a}).filesDownload({path:e})).result.fileBlob.text();return JSON.parse(c)},h=async()=>{const e=await application.getPlugins();await d(i,e),n({type:"message",message:"Successfully saved plugins."})},k=async()=>{const e=await u(r);await application.addPlaylists(e),n({type:"message",message:"Successfully added playlists."})},b=async()=>{const e=await application.getPlaylists();await d(r,e),n({type:"message",message:"Successfully saved playlists."})},w=async()=>{const e=await u(i);application.installPlugins(e)},I=async()=>{const t=document.location.host.split(".");t.shift();const o=t.join("."),s=`${document.location.protocol}//${o}`,c=await application.getPluginId(),l=localStorage.getItem("clientId")??"";n({type:"info",origin:s,pluginId:c,clientId:l})};application.onUiMessage=async e=>{switch(e.type){case"login":let t=e.accessToken,o=e.refreshToken;localStorage.setItem("access_token",t),localStorage.setItem("refresh_token",o),g(t,o);break;case"check-login":const s=localStorage.getItem("access_token");s&&n({type:"login",accessToken:s}),await I();break;case"save-plugins":await h();break;case"load-plugins":await w();break;case"save-playlists":await b();break;case"load-playlists":await k();break;case"set-keys":localStorage.setItem("clientId",e.clientId),p(e.clientId);break;case"logout":localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token");break}};const f=()=>new Promise((e,t)=>{const o="https://unpkg.com/dropbox/dist/Dropbox-sdk.min.js",s=document.createElement("script");s.src=o,s.type="text/javascript",document.getElementsByTagName("head")[0].appendChild(s),s.onload=()=>{e()},s.onerror=()=>{t()}}),m=e=>{localStorage.setItem("vite-ui-theme",e)};application.onChangeTheme=async e=>{m(e)};const S=async()=>{await f();const e=localStorage.getItem("clientId");p(e);let t=localStorage.getItem("access_token"),o=localStorage.getItem("refresh_token");t&&o&&g(t,o);const s=await application.getTheme();m(s)};S();
